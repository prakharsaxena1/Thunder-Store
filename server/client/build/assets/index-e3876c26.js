import{h as G,b as T,a as t,j as n,c as C,o as M,q as B,t as x,r as c,f as U,L as I,e as _,F as W}from"./index-c532219d.js";import{P as Q}from"./product.api-6faa34f7.js";import{I as V}from"./index-4c74a123.js";import{R as $,P as N}from"./index-5395b612.js";import{c as Y,d as H}from"./AccountCircle-d6edb3af.js";import{U as J,P as K}from"./user.api-0ba6d604.js";import{T as X}from"./index-a2692f30.js";import{u as S}from"./user.selector-3f16c101.js";import{B as E}from"./Box-468bb675.js";import{G as y}from"./Grid-b8fb3a11.js";import{S as p}from"./Stack-9a7d6fdd.js";import{T as u}from"./Typography-cb50676a.js";import{B as L,T as b,D as Z}from"./TextField-4d23d510.js";import{d as ee,C as te}from"./Delete-211e5082.js";import{r as ie,i as re,a as ae}from"./jsx-runtime_commonjs-proxy-6abecf05.js";import{d as ne}from"./dayjs.min-5ae63d11.js";import{P as A}from"./Paper-09fff5fc.js";import{I as P}from"./IconButton-4cf745ba.js";import{R as oe}from"./Rating-bcc8cf58.js";import"./ButtonBase-c29cbbf3.js";import"./createSvgIcon-bfe4a7b4.js";import"./Toolbar-5d7ff2ef.js";import"./AccordionSummary-cf7a2d84.js";import"./utils-42395edc.js";import"./Tooltip-d559d638.js";import"./Tabs-5d9f3ab3.js";import"./TableRow-d8305a28.js";const se=({product:e})=>{const i=G(),a=T(Y),r=T(S),[o]=J.useAddItemToCartMutation(),d=()=>{r.id&&o({productId:e._id,operation:"add"}),i(M({productID:e._id,title:e.title,price:e.price,discount:e.discount,image:e.images[0],stock:e.stock}))};return t(E,{children:n(y,{container:!0,spacing:2,justifyContent:"center",children:[t(y,{item:!0,xs:10,sm:6,md:5,children:t(V,{items:e.images||[]})}),t(y,{item:!0,xs:10,sm:6,md:7,children:n(p,{direction:"column",spacing:1,children:[t(X,{productTitle:e.title,single:!0}),n(p,{direction:"row",alignItems:"center",spacing:1,children:[t($,{rateValue:e.rating.rate/e.rating.count}),t(u,{variant:"body2",children:`(${e.rating.count})`})]}),n(p,{spacing:1,justifyContent:"flex-start",alignItems:"flex-start",children:[e.stock===0?t(u,{variant:"body1",sx:{color:C.outOfStock},children:"Out of stock"}):t(N,{price:e.price,discount:e.discount}),e.stock<=10&&e.stock>0&&t(u,{variant:"body2",sx:{color:C.stockLeft},children:`Only ${e.stock} left in stock!`}),t(L,{variant:"contained",color:"warning",disabled:!!a.cartId[e._id]||e.stock===0,onClick:d,children:"Add to cart"})]}),t(u,{variant:"body1",children:e.description})]})})]})})};var k={},de=re;Object.defineProperty(k,"__esModule",{value:!0});var j=k.default=void 0,ce=de(ie()),le=ae,ue=(0,ce.default)((0,le.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");j=k.default=ue;const D=B.injectEndpoints({endpoints:e=>({addReview:e.mutation({query:({productID:i,...a})=>({url:`${x.reviews.productReview}/${i}`,method:"POST",body:a}),invalidatesTags:["productReview"]}),updateReview:e.mutation({query:({reviewId:i,...a})=>({url:`${x.reviews.review}/${i}`,method:"PUT",body:a}),invalidatesTags:["productReview"]}),deleteReview:e.mutation({query:({reviewId:i})=>({url:`${x.reviews.review}/${i}`,method:"DELETE"}),invalidatesTags:["productReview"]}),getAllReview:e.query({query:({productID:i})=>({url:`${x.reviews.productReview}/${i}`,method:"GET"}),providesTags:["productReview"]}),getOneReview:e.query({query:({reviewId:i})=>({url:`${x.reviews.review}/${i}`,method:"GET"}),providesTags:["productReview"]})})}),pe=({review:e,setData:i,setShowModal:a})=>{const[r,o]=c.useState(!1),d=T(S),[s,{isLoading:m,isFetching:l}]=D.useLazyGetOneReviewQuery(),[h,{isLoading:f}]=D.useDeleteReviewMutation(),g=()=>{s({reviewId:e._id},!0).unwrap().then(w=>{i(w),a(!0)})},R=()=>{h({reviewId:e._id}).unwrap().then(()=>i(null)),o(!1)};return n(A,{children:[n(y,{container:!0,sx:{position:"relative"},children:[t(y,{item:!0,xs:12,sm:4,md:3,lg:3,sx:{backgroundColor:C.primary,p:"1rem"},children:n(p,{direction:"column",children:[n(p,{direction:"row",spacing:1,children:[t(H,{}),t(u,{variant:"body1",children:e==null?void 0:e.userID.username})]}),t($,{rateValue:e==null?void 0:e.rating}),t(u,{variant:"body1",children:ne(e==null?void 0:e.updatedAt).format(U.dateOnly)})]})}),t(y,{item:!0,xs:12,sm:8,md:9,lg:9,children:n(p,{direction:"column",sx:{maxWidth:"95%",m:"8px auto"},children:[t(u,{variant:"h6",children:e==null?void 0:e.title}),t(u,{variant:"body2",children:e==null?void 0:e.description})]})}),d.id===(e==null?void 0:e.userID._id)&&n(E,{sx:{position:"absolute",top:10,right:10},children:[t(P,{onClick:g,children:t(j,{fontSize:"small"})}),t(P,{onClick:()=>o(!0),children:t(ee,{fontSize:"small"})})]}),r&&t(te,{open:r,onClose:()=>o(!1),onConfirm:R,message:"Are you sure you want to delete your review?",confirmLabel:"Yes"})]}),(m||l||f)&&t(I,{})]})},me=({showModal:e,setShowModal:i,id:a,data:r})=>{const[o,d]=c.useState(0),[s,m]=c.useState(""),[l,h]=c.useState(""),[f,g]=c.useState({ratingError:!1,titleError:!1,descriptionError:!1});c.useEffect(()=>{r&&(d(r.rating),m(r.title),h(r.description))},[r]);const[R,{isLoading:w}]=D.useAddReviewMutation(),[q,{isLoading:O}]=D.useUpdateReviewMutation(),z=()=>{const v={ratingError:o===0,titleError:s.trim()==="",descriptionError:l.trim()===""};g(v),!v.ratingError&&!v.titleError&&!v.descriptionError&&(r?q({rating:o,title:s,description:l,reviewId:r._id}).unwrap().then(()=>{d(0),m(""),h(""),i(!1)}):R({rating:o,title:s,description:l,productID:a}).unwrap().then(()=>{d(0),m(""),h(""),i(!1)}))};return n(K,{showModal:e,setShowModal:i,title:"Write a review",children:[n(p,{direction:"column",justifyContent:"space-around",spacing:3,sx:{padding:"1rem"},children:[t(oe,{size:"large",value:o,onChange:(v,F)=>d(F||0),precision:.5}),f.ratingError&&t(u,{variant:"caption",display:"block",color:"error",children:"Fill a rating"}),t(b,{label:"Title",variant:"outlined",value:s,error:f.titleError,onChange:v=>m(v.target.value)}),t(b,{multiline:!0,minRows:5,maxRows:10,placeholder:"Description",value:l,onChange:v=>h(v.target.value),error:f.descriptionError,style:{width:"100%"}}),t(p,{justifyContent:"space-around",gap:3,sx:{padding:"0.5rem 1rem"},children:t(L,{variant:"contained",size:"large",sx:{width:"100px",margin:"auto"},onClick:z,children:"Submit"})})]}),(w||O)&&t(I,{})]})},ge=()=>t(E,{sx:{p:2},component:A,children:t(u,{variant:"h5",align:"center",children:"No reviews"})}),he=({reviews:e})=>{const{id:i}=_(),[a,r]=c.useState(!1),[o,d]=c.useState(!1),[s,m]=c.useState(null),[l,h]=c.useState([]),f=T(S);return c.useEffect(()=>{if(e&&f.id){const g=e.find(w=>w.userID._id===f.id),R=e.filter(w=>w.userID._id!==f.id);g!=null?h([g,...R]):h([...R]),d(g===void 0)}},[e]),n(W,{children:[n(p,{direction:"row",justifyContent:"space-between",children:[t(u,{variant:"h4",children:"Reviews"}),o&&t(L,{variant:"contained",color:"primary",size:"small",onClick:()=>r(!0),children:"Add a review"})]}),t(Z,{}),t(p,{direction:"column",spacing:1,alignItems:"stretch",children:l.length>0?l.map((g,R)=>t(pe,{review:g,setData:m,setShowModal:r},R)):t(ge,{})}),a&&t(me,{showModal:a,setShowModal:r,id:i||"",data:(s==null?void 0:s.review)||null})]})},Ue=()=>{const{id:e}=_(),[i,{data:a,isLoading:r,isFetching:o}]=D.useLazyGetAllReviewQuery(),[d,{data:s,isLoading:m,isFetching:l}]=Q.useLazyGetProductWithIDQuery();return c.useEffect(()=>{d({id:e},!0),i({productID:e},!0)},[e]),r||o||m||l||!s||!a?t(I,{}):t(E,{sx:{p:2,width:{sm:"90%",md:"80%",lg:"70%"},m:"1rem auto"},children:n(p,{spacing:3,children:[t(se,{product:s.product}),t(he,{reviews:a.reviews||[]})]})})};export{Ue as default};
